<!--pages/my/index.wxml-->
<view class="profile-page">
  <!-- å¤´éƒ¨ç”¨æˆ·ä¿¡æ¯åŒºåŸŸ -->
  <view class="profile-header">
    <view class="header-background"></view>
    <view class="header-content">
      <!-- ç”¨æˆ·å¤´åƒå’ŒåŸºæœ¬ä¿¡æ¯ -->
      <view class="user-info-section">
        <view class="avatar-container">
          <image 
            class="user-avatar" 
            src="{{backendUserData.wechatAvatar || backendUserData.avatarUrl || '/images/header.png'}}"
            wx:if="{{backendUserData}}"
          ></image>
          <image 
            class="user-avatar" 
            src="{{userInfo.avatarUrl || '/images/header.png'}}"
            wx:else
          ></image>
          <view class="avatar-edit-btn" bindtap="editAvatar">
            <text class="edit-icon">ğŸ“·</text>
          </view>
        </view>
        
        <view class="user-basic-info">
          <view class="user-name">
            <text class="name-text">{{backendUserData.name || backendUserData.nickName || userInfo.nickName || 'æœªè®¾ç½®'}}</text>
            <view class="edit-name-btn" bindtap="editUserName">
              <text class="edit-icon">âœï¸</text>
            </view>
          </view>
          <view class="user-title">
            <text class="title-text">{{backendUserData.school.name || 'æœªè®¾ç½®å­¦æ ¡'}}</text>
          </view>
          <view class="user-subtitle">
            <text class="subtitle-text">{{backendUserData.community.name || 'æœªè®¾ç½®ç¤¾åŒº'}}</text>
          </view>
        </view>
      </view>
      
      <!-- ç”¨æˆ·ç»Ÿè®¡ä¿¡æ¯ -->
      <view class="user-stats" wx:if="{{backendUserData}}">
        <view class="stat-item">
          <text class="stat-value">{{backendUserData.id}}</text>
          <text class="stat-label">ç”¨æˆ·ID</text>
        </view>
        <view class="stat-divider"></view>
        <view class="stat-item">
          <text class="stat-value">{{userGenderText}}</text>
          <text class="stat-label">æ€§åˆ«</text>
        </view>
        <view class="stat-divider"></view>
        <view class="stat-item">
          <text class="stat-value">{{userAge}}</text>
          <text class="stat-label">å¹´é¾„</text>
        </view>
      </view>
    </view>
  </view>

  <!-- ä¸»è¦å†…å®¹åŒºåŸŸ -->
  <view class="main-content">
    
    <!-- ä¸ªäººä¿¡æ¯å¡ç‰‡ -->
    <view class="info-card">
      <view class="card-header">
        <view class="header-left">
          <text class="card-title">ä¸ªäººä¿¡æ¯</text>
        </view>
        <view class="header-right">
          <view class="edit-btn" bindtap="editPersonalInfo">
            <text class="edit-text">ç¼–è¾‘</text>
          </view>
        </view>
      </view>
      
      <view class="info-list">
        <view class="info-item">
          <text class="info-label">å§“å</text>
          <text class="info-value">{{backendUserData.name || 'æœªè®¾ç½®'}}</text>
        </view>
        <view class="info-item">
          <text class="info-label">æ€§åˆ«</text>
          <text class="info-value">{{userGenderText}}</text>
        </view>
        <view class="info-item">
          <text class="info-label">ç”Ÿæ—¥</text>
          <text class="info-value">{{userBirthdayText}}</text>
        </view>
        <view class="info-item">
          <text class="info-label">è”ç³»æ–¹å¼</text>
          <text class="info-value">{{backendUserData.contactNumber || 'æœªè®¾ç½®'}}</text>
        </view>
        <view class="info-item">
          <text class="info-label">å®¶é•¿å§“å</text>
          <text class="info-value">{{backendUserData.parentsName || 'æœªè®¾ç½®'}}</text>
        </view>
      </view>
    </view>

    <!-- å­¦æ ¡ä¿¡æ¯å¡ç‰‡ -->
    <view class="info-card">
      <view class="card-header">
        <view class="header-left">
          <text class="card-title">å­¦æ ¡ä¿¡æ¯</text>
        </view>
        <view class="header-right">
          <view class="edit-btn" bindtap="editSchoolInfo">
            <text class="edit-text">ç¼–è¾‘</text>
          </view>
        </view>
      </view>
      
      <view class="info-list">
        <view class="info-item">
          <text class="info-label">å­¦æ ¡åç§°</text>
          <text class="info-value">{{backendUserData.school.name || 'æœªè®¾ç½®'}}</text>
        </view>
        <view class="info-item">
          <text class="info-label">æ³¨å†Œå­¦ç”Ÿæ•°</text>
          <text class="info-value">{{backendUserData.school.registeredStudentsCount || '0'}}äºº</text>
        </view>
        <view class="info-item">
          <text class="info-label">åœ°åŒº</text>
          <text class="info-value">{{backendUserData.school.distinct || 'æœªè®¾ç½®'}}</text>
        </view>
      </view>
    </view>

    <!-- ç¤¾åŒºä¿¡æ¯å¡ç‰‡ -->
    <view class="info-card">
      <view class="card-header">
        <view class="header-left">
          <text class="card-title">ç¤¾åŒºä¿¡æ¯</text>
        </view>
        <view class="header-right">
          <view class="edit-btn" bindtap="editCommunityInfo">
            <text class="edit-text">ç¼–è¾‘</text>
          </view>
        </view>
      </view>
      
      <view class="info-list">
        <view class="info-item">
          <text class="info-label">ç¤¾åŒºåç§°</text>
          <text class="info-value">{{backendUserData.community.name || 'æœªè®¾ç½®'}}</text>
        </view>
        <view class="info-item">
          <text class="info-label">å­¦ç”Ÿæ•°é‡</text>
          <text class="info-value">{{backendUserData.community.studentsCount || '0'}}äºº</text>
        </view>
        <view class="info-item">
          <text class="info-label">åœ°åŒº</text>
          <text class="info-value">{{backendUserData.community.distinct.name || 'æœªè®¾ç½®'}}</text>
        </view>
      </view>
    </view>

    <!-- ç³»ç»Ÿä¿¡æ¯å¡ç‰‡ -->
    <view class="info-card">
      <view class="card-header">
        <view class="header-left">
          <text class="card-title">ç³»ç»Ÿä¿¡æ¯</text>
        </view>
      </view>
      
      <view class="info-list">
        <view class="info-item">
          <text class="info-label">æ³¨å†Œæ—¶é—´</text>
          <text class="info-value">{{userRegisterDateText}}</text>
        </view>
        <view class="info-item">
          <text class="info-label">æœ€åæ›´æ–°</text>
          <text class="info-value">{{userUpdateDateText}}</text>
        </view>
        <view class="info-item">
          <text class="info-label">åˆåŒåˆ°æœŸ</text>
          <text class="info-value">{{userContractEndDateText}}</text>
        </view>
      </view>
    </view>

    <!-- åŠŸèƒ½æŒ‰é’®åŒºåŸŸ -->
    <view class="function-section">
      <view class="function-btn" bindtap="go_view" data-viewInd="0">
        <image class="btn-icon" src="/images/icon_equipment_msg.png"></image>
        <view class="btn-content">
          <text class="btn-title">ç­”é¢˜è®°å½•</text>
          <text class="btn-desc">æŸ¥çœ‹å†å²ç­”é¢˜è®°å½•</text>
        </view>
        <text class="btn-arrow">â€º</text>
      </view>
      
      <view class="function-btn" bindtap="go_view" data-viewInd="2">
        <image class="btn-icon" src="/images/icon_center_msg.png"></image>
        <view class="btn-content">
          <text class="btn-title">æ„è§åé¦ˆ</text>
          <text class="btn-desc">æäº¤å»ºè®®å’Œé—®é¢˜</text>
        </view>
        <text class="btn-arrow">â€º</text>
      </view>
      
      <button class="function-btn share-btn" openType="share">
        <image class="btn-icon" src="/images/icon_center_phone.png"></image>
        <view class="btn-content">
          <text class="btn-title">åˆ†äº«å¥½å‹</text>
          <text class="btn-desc">é‚€è¯·å¥½å‹ä¸€èµ·å­¦ä¹ </text>
        </view>
        <text class="btn-arrow">â€º</text>
      </button>
      
      <view class="function-btn" bindtap="about">
        <image class="btn-icon" src="/images/icon_center_tj.png"></image>
        <view class="btn-content">
          <text class="btn-title">å…³äºæˆ‘ä»¬</text>
          <text class="btn-desc">äº†è§£æ›´å¤šä¿¡æ¯</text>
        </view>
        <text class="btn-arrow">â€º</text>
      </view>
    </view>
  </view>

  <!-- ç™»å½•å¼¹çª— -->
  <view class="login-modal" wx:if="{{!is_login}}">
    <view class="modal-content">
      <view class="modal-header">
        <text class="modal-title">æ‚¨è¿˜æœªç™»å½•</text>
        <text class="modal-subtitle">è¯·å…ˆç™»å½•å†è¿›è¡Œæ“ä½œ</text>
      </view>
      <view class="modal-image"></view>
      <view class="modal-buttons">
        <button class="modal-btn cancel-btn" bindtap='login'>æš‚ä¸ç™»å½•</button> 
        <button 
          wx:if="{{canIUseGetUserProfile}}"  
          class="modal-btn confirm-btn" 
          bindtap="getUserProfile"
        >ç«‹å³ç™»å½•</button>
        <button 
          wx:else 
          class="modal-btn confirm-btn" 
          open-type="getUserInfo" 
          bindgetuserinfo="bindgetuserinfo"
        >ç«‹å³ç™»å½•</button> 
      </view>
    </view>
    <view class="modal-mask"></view>
  </view>
</view>